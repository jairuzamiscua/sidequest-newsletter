<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SideQuest Mail Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    :root {
      /* SideQuest Brand Colors */
      --primary: #FFD700;
      --primary-light: #FFED4A;
      --primary-dark: #FFA500;
      --secondary: #FF6B35;
      --accent: #FF4757;
      --success: #00ff88;
      --warning: #ff6b35;
      --danger: #ff4757;
      --info: #8b5cf6;
      
      /* Dark Theme */
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #2a2a2a;
      --bg-card: #1e1e1e;
      --bg-elevated: #252525;
      
      /* Text Colors */
      --text-primary: #ffffff;
      --text-secondary: #e5e5e5;
      --text-muted: #a1a1a1;
      --text-faded: #6b7280;
      
      /* Border Colors */
      --border-light: rgba(255, 215, 0, 0.1);
      --border-medium: rgba(255, 215, 0, 0.2);
      --border-strong: rgba(255, 215, 0, 0.3);
      --border-subtle: rgba(255, 255, 255, 0.1);
      
      /* Shadows */
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.2);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-gold: 0 8px 32px rgba(255, 215, 0, 0.15);
      
      /* Border Radius */
      --radius-sm: 0.5rem;
      --radius: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.25rem;
      --radius-2xl: 1.5rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
      overflow-x: hidden;
    }
    
    .dashboard-layout {
      display: grid;
      grid-template-columns: 300px 1fr;
      min-height: 100vh;
    }
    
    /* Sidebar */
    .sidebar {
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
      border-right: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      width: 300px;
      z-index: 50;
    }
    
    .sidebar-header {
      padding: 2rem;
      border-bottom: 1px solid var(--border-light);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .logo-icon {
      width: 3rem;
      height: 3rem;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 1rem;
      color: var(--bg-primary);
      letter-spacing: -0.05em;
      box-shadow: var(--shadow-gold);
    }
    
    .logo-content h1 {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -0.025em;
    }
    
    .logo-content p {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }
    
    .nav-menu {
      flex: 1;
      padding: 1.5rem 1rem;
      overflow-y: auto;
    }
    
    .nav-section {
      margin-bottom: 2rem;
    }
    
    .nav-section-title {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
      padding: 0 1rem;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-lg);
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.925rem;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      margin-bottom: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    
    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 0;
      height: 100%;
      background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
      transition: width 0.3s ease;
      z-index: -1;
    }
    
    .nav-item:hover {
      color: var(--text-primary);
      background: rgba(255, 215, 0, 0.1);
      transform: translateX(4px);
    }
    
    .nav-item.active {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--bg-primary);
      font-weight: 700;
      box-shadow: var(--shadow-gold);
    }
    
    .nav-item.active::before {
      width: 100%;
    }
    
    .nav-icon {
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.125rem;
    }

    /* Logout Button */
    .logout-btn {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      font-size: 0.8rem;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .logout-btn:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border-color: var(--border-light);
    }
    
    /* Main Content Area */
    .main-content {
      margin-left: 300px;
      min-height: 100vh;
      background: var(--bg-primary);
    }
    
    .content-wrapper {
      padding: 2.5rem;
    }
    
    .page-header {
      margin-bottom: 3rem;
      position: relative;
    }
    
    .page-title {
      font-size: 2.5rem;
      font-weight: 900;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
      letter-spacing: -0.05em;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .page-subtitle {
      color: var(--text-muted);
      font-size: 1.125rem;
      font-weight: 400;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }
    
    .stat-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-2xl);
      padding: 2rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
    }
    
    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-lg);
      border-color: var(--border-light);
    }
    
    .stat-card.success::before { background: linear-gradient(90deg, var(--success) 0%, #00cc6a 100%); }
    .stat-card.warning::before { background: linear-gradient(90deg, var(--warning) 0%, #e55e2b 100%); }
    .stat-card.info::before { background: linear-gradient(90deg, var(--info) 0%, #7c3aed 100%); }
    
    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    
    .stat-title {
      color: var(--text-secondary);
      font-size: 0.925rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .stat-icon {
      width: 3rem;
      height: 3rem;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      background: rgba(255, 215, 0, 0.1);
      color: var(--primary);
    }
    
    .stat-icon.success {
      background: rgba(0, 255, 136, 0.1);
      color: var(--success);
    }
    
    .stat-icon.warning {
      background: rgba(255, 107, 53, 0.1);
      color: var(--warning);
    }
    
    .stat-icon.info {
      background: rgba(139, 92, 246, 0.1);
      color: var(--info);
    }
    
    .stat-value {
      font-size: 3rem;
      font-weight: 900;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      letter-spacing: -0.05em;
      line-height: 1;
    }
    
    .stat-change {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.925rem;
      font-weight: 600;
    }
    
    .stat-change.positive { color: var(--success); }
    .stat-change.negative { color: var(--danger); }
    .stat-change.neutral { color: var(--text-muted); }
    
    /* Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2.5rem;
      margin-bottom: 3rem;
    }
    
    /* Cards */
    .card {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-2xl);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--border-light);
    }
    
    .card-header {
      padding: 2rem 2rem 1rem;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .card-content {
      padding: 2rem;
    }
    
    /* Tab Navigation */
    .tab-nav {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: var(--radius-xl);
      padding: 0.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-subtle);
    }
    
    .tab-item {
      flex: 1;
      padding: 1rem 1.5rem;
      text-align: center;
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
      font-size: 0.925rem;
      color: var(--text-muted);
      position: relative;
    }
    
    .tab-item.active {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--bg-primary);
      box-shadow: var(--shadow-gold);
      transform: translateY(-1px);
    }
    
    .tab-item:not(.active):hover {
      color: var(--text-secondary);
      background: rgba(255, 215, 0, 0.05);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Forms */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.925rem;
    }
    
    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      font-size: 0.925rem;
      transition: all 0.3s ease;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-family: inherit;
    }
    
    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
      background: var(--bg-elevated);
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: var(--radius-lg);
      font-weight: 600;
      font-size: 0.875rem;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      line-height: 1;
      position: relative;
      overflow: hidden;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-sm {
      padding: 0.625rem 1rem;
      font-size: 0.8125rem;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--bg-primary);
      box-shadow: var(--shadow-gold);
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(255, 215, 0, 0.3);
    }
    
    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border-color: var(--border-light);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, #00cc6a 100%);
      color: var(--bg-primary);
      box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
    }
    
    .btn-success:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, var(--warning) 0%, #e55e2b 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
    }
    
    .btn-warning:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.2);
    }
    
    .btn-danger:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3);
    }
    
    /* Search */
    .search-box {
      position: relative;
      margin-bottom: 1.5rem;
    }
    
    .search-input {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 3rem;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      font-size: 0.925rem;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .search-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
    }
    
    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary);
      font-size: 1.125rem;
    }
    
    /* Subscriber List */
    .subscriber-list {
      max-height: 450px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--bg-tertiary);
    }
    
    .subscriber-list::-webkit-scrollbar {
      width: 8px;
    }
    
    .subscriber-list::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }
    
    .subscriber-list::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }
    
    .subscriber-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border-subtle);
      transition: all 0.2s ease;
    }
    
    .subscriber-item:hover {
      background: rgba(255, 215, 0, 0.05);
      border-radius: var(--radius-lg);
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .subscriber-item:last-child {
      border-bottom: none;
    }
    
    .subscriber-info {
      flex: 1;
    }
    
    .subscriber-email {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1.05rem;
    }
    
    .subscriber-meta {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }
    
    /* Activity Feed */
    .activity-feed {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }
    
    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border-subtle);
      transition: all 0.2s ease;
    }
    
    .activity-item:hover {
      background: rgba(255, 215, 0, 0.03);
      border-radius: var(--radius-lg);
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .activity-icon {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    .activity-icon.success {
      background: rgba(0, 255, 136, 0.15);
      color: var(--success);
    }
    
    .activity-icon.danger {
      background: rgba(255, 71, 87, 0.15);
      color: var(--danger);
    }
    
    .activity-icon.info {
      background: rgba(255, 215, 0, 0.15);
      color: var(--primary);
    }
    
    .activity-content {
      flex: 1;
      min-width: 0;
    }
    
    .activity-text {
      color: var(--text-primary);
      font-size: 0.925rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      line-height: 1.5;
    }
    
    .activity-time {
      color: var(--text-muted);
      font-size: 0.8125rem;
      font-weight: 500;
    }

    /* Chart Container */
    .chart-container {
      height: 280px;
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      padding: 1.5rem;
      border: 1px solid var(--border-subtle);
      margin-top: 1rem;
    }

    /* Source Stats */
    .source-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .source-stat {
      text-align: center;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      transition: all 0.3s ease;
    }

    .source-stat:hover {
      border-color: var(--border-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .source-stat-value {
      font-size: 2rem;
      font-weight: 900;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .source-stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    /* Events Styles */
    .event-nav {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 2rem;
      padding: 0.75rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
    }

    .event-nav-btn {
      padding: 0.75rem 1.25rem;
      background: transparent;
      color: var(--text-muted);
      border: none;
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .event-nav-btn.active {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--bg-primary);
      box-shadow: var(--shadow-gold);
    }

    .event-nav-btn:hover:not(.active) {
      background: var(--bg-elevated);
      color: var(--text-secondary);
    }

    .event-view {
      display: none;
    }

    .event-view.active {
      display: block;
    }

    .events-container {
      display: grid;
      gap: 1.5rem;
    }

    .event-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%);
      border-radius: var(--radius-xl);
      padding: 2rem;
      border-left: 4px solid var(--primary);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border: 1px solid var(--border-subtle);
    }

    .event-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--border-light);
    }

    .event-card.tournament { border-left-color: var(--secondary); }
    .event-card.game_night { border-left-color: #4ECDC4; }
    .event-card.special { border-left-color: var(--info); }
    .event-card.birthday { border-left-color: #FF69B4; }

    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    .event-title {
      font-size: 1.375rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      letter-spacing: -0.025em;
    }

    .event-game {
      font-size: 0.925rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .event-badge {
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .badge-tournament {
      background: rgba(255, 107, 53, 0.15);
      color: var(--secondary);
      border: 1px solid rgba(255, 107, 53, 0.3);
    }

    .badge-game_night {
      background: rgba(76, 205, 196, 0.15);
      color: #4ECDC4;
      border: 1px solid rgba(76, 205, 196, 0.3);
    }

    .badge-special {
      background: rgba(139, 92, 246, 0.15);
      color: var(--info);
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .badge-birthday {
      background: rgba(255, 105, 180, 0.15);
      color: #FF69B4;
      border: 1px solid rgba(255, 105, 180, 0.3);
    }

    .event-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .event-detail {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.925rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .event-detail-icon {
      color: var(--primary);
      font-size: 1.125rem;
    }

    .event-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
    }

    .capacity-bar {
      width: 100%;
      height: 25px;
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      overflow: hidden;
      margin-top: 1rem;
      position: relative;
    }

    .capacity-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
      transition: width 0.3s ease;
    }

    .capacity-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: 600;
      font-size: 0.85rem;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%);
      border-radius: var(--radius-2xl);
      padding: 2.5rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-lg);
    }

    .modal-close {
      position: absolute;
      right: 1.5rem;
      top: 1.5rem;
      font-size: 1.75rem;
      font-weight: bold;
      color: var(--primary);
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .modal-close:hover {
      color: var(--primary-dark);
    }

    .attendee-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 1rem;
    }

    .attendee-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      margin-bottom: 0.75rem;
      border: 1px solid var(--border-subtle);
      transition: all 0.2s ease;
    }

    .attendee-item:hover {
      border-color: var(--border-light);
      background: var(--bg-tertiary);
    }

    .attendee-email {
      color: var(--text-primary);
      font-weight: 600;
    }

    .attendee-status {
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-lg);
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-attended { 
      background: rgba(0, 255, 136, 0.15);
      color: var(--success);
      border: 1px solid rgba(0, 255, 136, 0.3);
    }

    .status-registered { 
      background: rgba(255, 215, 0, 0.15);
      color: var(--primary);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }

    /* FullCalendar Styling */
    .fc {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%);
      border-radius: var(--radius-2xl);
      border: 1px solid var(--border-subtle);
      overflow: hidden;
    }

    .fc-header-toolbar {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 1.5rem 2rem !important;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 0 !important;
    }

    .fc-toolbar-title {
      color: var(--bg-primary) !important;
      font-weight: 800 !important;
      font-size: 1.5rem !important;
      letter-spacing: -0.025em !important;
    }

    .fc-button {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-subtle) !important;
      color: var(--primary) !important;
      font-weight: 600 !important;
      border-radius: var(--radius-lg) !important;
      padding: 0.5rem 1rem !important;
      transition: all 0.3s ease !important;
    }

    .fc-button:hover {
      background: var(--primary) !important;
      color: var(--bg-primary) !important;
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-gold) !important;
    }

    .fc-button-active {
      background: var(--primary) !important;
      color: var(--bg-primary) !important;
    }

    .fc-view-harness {
      background: var(--bg-secondary);
    }

    .fc-day {
      background: var(--bg-card) !important;
      border-color: var(--border-subtle) !important;
      transition: all 0.3s ease;
    }

    .fc-day:hover {
      background: var(--bg-elevated) !important;
    }

    .fc-day-today {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.1) 100%) !important;
      border-color: var(--primary) !important;
    }

    .fc-col-header {
      background: var(--bg-tertiary) !important;
      border-bottom: 1px solid var(--border-light) !important;
    }

    .fc-col-header-cell-cushion {
      color: var(--primary) !important;
      font-weight: 700 !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      padding: 1rem 0 !important;
    }

    .fc-daygrid-day-number {
      color: var(--text-primary) !important;
      font-weight: 600 !important;
      padding: 0.5rem !important;
    }

    .fc-event {
      border: none !important;
      border-radius: var(--radius) !important;
      padding: 0.25rem 0.5rem !important;
      margin: 0.125rem !important;
      font-weight: 600 !important;
      font-size: 0.75rem !important;
      cursor: pointer !important;
      transition: all 0.2s ease !important;
      border-left: 3px solid transparent !important;
    }

    .fc-event:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-md) !important;
    }

    .fc-event.tournament {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%) !important;
      color: white !important;
      border-left-color: var(--secondary) !important;
    }

    .fc-event.game_night {
      background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%) !important;
      color: var(--bg-primary) !important;
      border-left-color: #4ECDC4 !important;
    }

    .fc-event.special {
      background: linear-gradient(135deg, var(--info) 0%, #7C3AED 100%) !important;
      color: white !important;
      border-left-color: var(--info) !important;
    }

    .fc-event.birthday {
      background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%) !important;
      color: white !important;
      border-left-color: #FF69B4 !important;
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 1.5rem;
      height: 1.5rem;
      border: 2px solid var(--border-subtle);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .dashboard-layout {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        position: fixed;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 100;
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .content-wrapper {
        padding: 1.5rem;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .event-actions {
        grid-template-columns: 1fr;
      }

      .source-stats {
        grid-template-columns: 1fr;
      }
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* Utilities */
    .text-center { text-align: center; }
    .text-success { color: var(--success); }
    .text-danger { color: var(--danger); }
    .text-warning { color: var(--warning); }
    .text-muted { color: var(--text-muted); }
    .mb-0 { margin-bottom: 0; }
    .mt-4 { margin-top: 1rem; }
    .hidden { display: none; }

    /* Custom Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">SQ</div>
          <div class="logo-content">
            <h1>SideQuest</h1>
            <p>Mail Dashboard</p>
          </div>
        </div>
      </div>
      
      <div class="nav-menu">
        <div class="nav-section">
          <div class="nav-section-title">Dashboard</div>
          <div class="nav-item active" data-tab="subscribers">
            <div class="nav-icon">üë•</div>
            <span>Subscribers</span>
          </div>
          <div class="nav-item" data-tab="analytics">
            <div class="nav-icon">üìä</div>
            <span>Analytics</span>
          </div>
          <div class="nav-item" data-tab="campaigns">
            <div class="nav-icon">üìß</div>
            <span>Campaigns</span>
          </div>
          <div class="nav-item" data-tab="events">
            <div class="nav-icon">üéÆ</div>
            <span>Events</span>
          </div>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <div class="nav-item" data-tab="tools">
            <div class="nav-icon">üõ†Ô∏è</div>
            <span>Admin Tools</span>
          </div>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">System</div>
          <div class="nav-item" onclick="window.open('https://app.brevo.com', '_blank')">
            <div class="nav-icon">üöÄ</div>
            <span>Brevo Dashboard</span>
          </div>
          <div class="nav-item" onclick="window.open('/signup', '_blank')">
            <div class="nav-icon">üëÅÔ∏è</div>
            <span>Preview Signup</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <div class="content-wrapper">
        <!-- Page Header -->
        <div class="page-header">
          <h1 class="page-title">SideQuest Mail Dashboard</h1>
          <p class="page-subtitle">Subscriber Management & Gaming Venue Platform</p>
          
          <!-- Logout Button -->
          <a href="/admin/logout" class="logout-btn">üîì Logout</a>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Total Subscribers</div>
              <div class="stat-icon">üë•</div>
            </div>
            <div class="stat-value" id="totalSubscribers">-</div>
            <div class="stat-change positive">
              <span>üìà</span>
              <span>Active subscribers</span>
            </div>
          </div>
          
          <div class="stat-card success">
            <div class="stat-header">
              <div class="stat-title">Today's Signups</div>
              <div class="stat-icon success">‚ú®</div>
            </div>
            <div class="stat-value" id="todaySignups">-</div>
            <div class="stat-change positive">
              <span>üìà</span>
              <span>New today</span>
            </div>
          </div>
          
          <div class="stat-card warning">
            <div class="stat-header">
              <div class="stat-title">This Week</div>
              <div class="stat-icon warning">üìÖ</div>
            </div>
            <div class="stat-value" id="thisWeekSignups">-</div>
            <div class="stat-change neutral">
              <span>üìä</span>
              <span>Week total</span>
            </div>
          </div>
          
          <div class="stat-card info">
            <div class="stat-header">
              <div class="stat-title">Brevo Sync</div>
              <div class="stat-icon info">üîÑ</div>
            </div>
            <div class="stat-value" id="brevoSyncStatus">‚è≥</div>
            <div class="stat-change positive">
              <span>üü¢</span>
              <span id="brevoStatus">Checking...</span>
            </div>
          </div>
        </div>
        
        <!-- Content Grid -->
        <div class="content-grid">
          <!-- Main Content Card -->
          <div class="card">
            <!-- Tab Navigation -->
            <div class="tab-nav">
              <div class="tab-item active" data-tab="subscribers">üë• Subscribers</div>
              <div class="tab-item" data-tab="analytics">üìä Analytics</div>
              <div class="tab-item" data-tab="campaigns">üìß Campaigns</div>
              <div class="tab-item" data-tab="tools">üõ†Ô∏è Tools</div>
              <div class="tab-item" data-tab="events">üéÆ Events</div>
            </div>

            <!-- Subscribers Tab -->
            <div class="tab-content active" id="subscribers">
              <div class="card-header">
                <h3 class="card-title">
                  <span>üë•</span>
                  Subscriber Management
                </h3>
                <div>
                  <button class="btn btn-primary btn-sm" onclick="refreshSubscribers()">üîÑ Refresh</button>
                  <button class="btn btn-success btn-sm" onclick="exportCSV()">üì§ Export</button>
                </div>
              </div>
              <div class="card-content">
                <!-- Search -->
                <div class="search-box">
                  <input type="text" class="search-input" id="searchInput" placeholder="Search subscribers...">
                  <span class="search-icon">üîç</span>
                </div>

                <!-- Add Subscriber -->
                <div class="form-group">
                  <label class="form-label">Add New Subscriber</label>
                  <div style="display: flex; gap: 0.75rem;">
                    <input type="email" class="form-input" id="newSubscriberEmail" placeholder="Enter email address">
                    <button class="btn btn-primary" onclick="addSubscriber()">Add</button>
                  </div>
                </div>

                <!-- Subscriber List -->
                <div class="subscriber-list" id="subscriberList">
                  <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem;">Loading subscribers...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-content" id="analytics">
              <div class="card-header">
                <h3 class="card-title">
                  <span>üìä</span>
                  Subscriber Analytics
                </h3>
              </div>
              <div class="card-content">
                <div class="form-group">
                  <label class="form-label">Growth Chart (Last 30 Days)</label>
                  <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Signup Sources</label>
                  <div class="source-stats">
                    <div class="source-stat">
                      <div class="source-stat-value" id="webSignups">-</div>
                      <div class="source-stat-label">Web Signups</div>
                    </div>
                    <div class="source-stat">
                      <div class="source-stat-value" id="manualSignups">-</div>
                      <div class="source-stat-label">Manual Adds</div>
                    </div>
                    <div class="source-stat">
                      <div class="source-stat-value" id="importSignups">-</div>
                      <div class="source-stat-label">Imports</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Campaigns Tab -->
            <div class="tab-content" id="campaigns">
              <div class="card-header">
                <h3 class="card-title">
                  <span>üìß</span>
                  Send Campaign
                </h3>
              </div>
              <div class="card-content">
                <div class="form-group">
                  <label class="form-label">Campaign Subject</label>
                  <input type="text" class="form-input" id="campaignSubject" placeholder="Enter email subject">
                </div>

                <div class="form-group">
                  <label class="form-label">From Name</label>
                  <input type="text" class="form-input" id="fromName" value="SideQuest Mail" placeholder="Sender name">
                </div>

                <div class="form-group">
                  <label class="form-label">Email Content (HTML)</label>
                  <textarea class="form-textarea" id="campaignBody" placeholder="Enter your email content in HTML format..." rows="8"></textarea>
                </div>

                <div class="form-group">
                  <label class="form-label">Recipients</label>
                  <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">
                    Campaign will be sent to all <span id="campaignRecipientCount">0</span> active subscribers
                  </p>
                  <button class="btn btn-primary" onclick="sendCampaign()">üìß Send Campaign</button>
                </div>
              </div>
            </div>

            <!-- Tools Tab -->
            <div class="tab-content" id="tools">
              <div class="card-header">
                <h3 class="card-title">
                  <span>üõ†Ô∏è</span>
                  Admin Tools
                </h3>
              </div>
              <div class="card-content">
                <div class="form-group">
                  <label class="form-label">Bulk Import Subscribers</label>
                  <textarea class="form-textarea" id="bulkEmails" placeholder="Enter emails, one per line:&#10;user1@example.com&#10;user2@example.com&#10;user3@example.com" rows="5"></textarea>
                  <button class="btn btn-primary mt-4" onclick="bulkImport()">üì• Import Subscribers</button>
                </div>

                <div class="form-group">
                  <label class="form-label">Generate QR Code</label>
                  <div style="display: flex; gap: 0.75rem;">
                    <input type="text" class="form-input" id="qrUrl" placeholder="Enter signup URL" value="http://localhost:4000/signup">
                    <button class="btn btn-primary" onclick="generateQR()">Generate QR</button>
                  </div>
                  <div class="qr-display" id="qrDisplay" style="display: none; margin-top: 1rem;">
                    <canvas id="qrCanvas"></canvas>
                    <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.875rem;">Right-click to save QR code</p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Data Management</label>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem;">
                    <button class="btn btn-secondary" onclick="backupData()">üíæ Backup Data</button>
                    <button class="btn btn-primary" onclick="manualBrevoSync()">üîÑ Sync Brevo</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Events Tab -->
            <div class="tab-content" id="events">
              <div class="event-nav">
                <button class="event-nav-btn active" data-view="list">üìã Event List</button>
                <button class="event-nav-btn" data-view="calendar">üìÖ Calendar View</button>
                <button class="event-nav-btn" data-view="create">‚ûï Create Event</button>
                <button class="event-nav-btn" data-view="stats">üìä Statistics</button>
              </div>

              <!-- Events List View -->
              <div class="event-view active" id="event-list-view">
                <div class="card-header">
                  <h3 class="card-title">
                    <span>üéÆ</span>
                    Upcoming Events
                  </h3>
                  <div>
                    <select id="eventTypeFilter" class="form-select" style="width: 150px; display: inline-block;" onchange="loadEvents()">
                      <option value="all">All Types</option>
                      <option value="tournament">Tournaments</option>
                      <option value="game_night">Game Nights</option>
                      <option value="special">Special Events</option>
                      <option value="birthday">Birthdays</option>
                    </select>
                  </div>
                </div>

                <div id="eventsList" class="events-container">
                  <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem;">Loading events...</p>
                  </div>
                </div>
              </div>

              <!-- Calendar View -->
              <div class="event-view" id="event-calendar-view">
                <div class="card-header">
                  <h3 class="card-title">
                    <span>üìÖ</span>
                    Event Calendar
                  </h3>
                  <button class="btn btn-primary btn-sm" onclick="refreshCalendar()">üîÑ Refresh</button>
                </div>
                
                <div id="fullCalendar" style="padding: 1.5rem;"></div>
              </div>

              <!-- Create Event View -->
              <div class="event-view" id="event-create-view">
                <div class="card-header">
                  <h3 class="card-title">
                    <span>‚ûï</span>
                    Create New Event
                  </h3>
                </div>

                <form id="createEventForm">
                  <div class="form-group">
                    <label class="form-label">Event Title*</label>
                    <input type="text" class="form-input" id="eventTitle" placeholder="e.g Valorant Friday Night Tournament" required>
                  </div>
                  
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="form-group">
                      <label class="form-label">Event Type*</label>
                      <select class="form-select" id="eventType" required>
                        <option value="">Select Type*</option>
                        <option value="tournament">Tournament</option>
                        <option value="game_night">Game Night</option>
                        <option value="special">Special Event</option>
                        <option value="birthday">Birthday</option>
                      </select>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Game Title</label>
                      <input type="text" class="form-input" id="gameTitle" placeholder="e.g Valorant, Fortnite">
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="form-group">
                      <label class="form-label">Start Date & Time*</label>
                      <input type="datetime-local" class="form-input" id="eventDateTime" required>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">End Date & Time</label>
                      <input type="datetime-local" class="form-input" id="eventEndTime">
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem;">
                    <div class="form-group">
                      <label class="form-label">Capacity</label>
                      <input type="number" class="form-input" id="eventCapacity" min="0" placeholder="0 (Unlimited)">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Entry Fee (¬£)</label>
                      <input type="text" class="form-input" id="eventFee" placeholder="0.00 (Free)">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Status</label>
                      <select class="form-select" id="eventStatus">
                        <option value="draft">Upcoming</option>
                        <option value="published">Completed</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="eventDescription" rows="4" placeholder="Event details, rules, what to bring..."></textarea>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Prize Pool (JSON format)</label>
                    <input type="text" class="form-input" id="eventPrizes" placeholder='{"1st": "¬£100", "2nd": "¬£50", "3rd": "¬£25"}'>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Requirements</label>
                    <input type="text" class="form-input" id="eventRequirements" placeholder="e.g., Bring your own controller">
                  </div>

                  <div style="display: flex; gap: 0.75rem;">
                    <button type="submit" class="btn btn-primary">üéÆ Create Event</button>
                    <button type="button" class="btn btn-secondary" onclick="resetEventForm()">Clear Form</button>
                  </div>
                </form>
              </div>
              
              <!-- Event Statistics View -->
              <div class="event-view" id="event-stats-view">
                <div class="card-header">
                  <h3 class="card-title">
                    <span>üìä</span>
                    Event Statistics
                  </h3>
                </div>
                
                <div class="stats-grid" style="margin-top: 2rem;">
                  <div class="stat-card primary">
                    <div class="stat-header">
                      <div class="stat-title">Total Events</div>
                      <div class="stat-icon">üéÆ</div>
                    </div>
                    <div class="stat-value" id="totalEvents">-</div>
                    <div class="stat-change neutral">
                      <span>üìä</span>
                      <span>All time</span>
                    </div>
                  </div>
                  <div class="stat-card success">
                    <div class="stat-header">
                      <div class="stat-title">Upcoming Events</div>
                      <div class="stat-icon success">üìÖ</div>
                    </div>
                    <div class="stat-value" id="upcomingEvents">-</div>
                    <div class="stat-change positive">
                      <span>üìà</span>
                      <span>Scheduled</span>
                    </div>
                  </div>
                  <div class="stat-card warning">
                    <div class="stat-header">
                      <div class="stat-title">Total Registrations</div>
                      <div class="stat-icon warning">üë•</div>
                    </div>
                    <div class="stat-value" id="totalEventRegistrations">-</div>
                    <div class="stat-change positive">
                      <span>üìä</span>
                      <span>All events</span>
                    </div>
                  </div>
                  <div class="stat-card info">
                    <div class="stat-header">
                      <div class="stat-title">Avg Capacity Filled</div>
                      <div class="stat-icon info">üìà</div>
                    </div>
                    <div class="stat-value" id="avgCapacityFilled">-%</div>
                    <div class="stat-change neutral">
                      <span>üìä</span>
                      <span>Average</span>
                    </div>
                  </div>
                </div>
                
                <div class="card-header" style="margin-top: 2rem;">
                  <h3 class="card-title">
                    <span>üèÜ</span>
                    Popular Events
                  </h3>
                </div>
                <div id="popularEventsList">
                  <p class="text-muted text-center">Loading statistics...</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Sidebar Cards -->
          <div>
            <!-- Quick Actions Card -->
            <div class="card" style="margin-bottom: 2rem;">
              <div class="card-header">
                <h3 class="card-title">
                  <span>‚ö°</span>
                  Quick Actions
                </h3>
              </div>
              <div class="card-content">
                <div style="display: grid; gap: 0.75rem;">
                  <button class="btn btn-primary" onclick="window.open('https://app.brevo.com', '_blank')">
                    <span>üöÄ</span>
                    Open Brevo Dashboard
                  </button>
                  <button class="btn btn-success" onclick="window.open('/signup', '_blank')">
                    <span>üëÅÔ∏è</span>
                    Preview Signup Page
                  </button>
                  <button class="btn btn-secondary" onclick="manualBrevoSync()">
                    <span>üîÑ</span>
                    Manual Sync
                  </button>
                  <button class="btn btn-warning" onclick="exportCSV()">
                    <span>üìä</span>
                    Export Data
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Recent Activity Card -->
            <div class="card" style="margin-bottom: 2rem;">
              <div class="card-header">
                <h3 class="card-title">
                  <span>üìà</span>
                  Recent Activity
                </h3>
              </div>
              <div class="card-content">
                <div class="activity-feed" id="activityLog">
                  <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem;">Loading activity...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- System Status Card -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <span>‚öôÔ∏è</span>
                  System Status
                </h3>
              </div>
              <div class="card-content">
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-primary);">Backend Server</span>
                    <span class="text-success" id="serverStatus">‚è≥ Checking...</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-primary);">Brevo API</span>
                    <span class="text-success" id="brevoApiStatus">‚è≥ Checking...</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-primary);">Last Activity</span>
                    <span class="text-muted" id="lastActivity">-</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Event Modal -->
  <div id="eventModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="modal-close" onclick="closeEventModal()">&times;</span>
      <h2 id="modalEventTitle"></h2>
      <div id="modalEventContent"></div>
    </div>
  </div>

  <script>
    // Configuration
    const API_BASE = 'https://sidequest-newsletter-production.up.railway.app';
    
    // Global variables
    let subscribers = [];
    let subscriberDetails = [];
    let activityLog = [];
    let currentStats = {};
    let growthChart = null;
    let calendar;
    let currentEvents = [];
    let currentEditingEventId = null;
    
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Dashboard initializing...');
      try {
        initializeTabs();
        loadInitialData();
        setupSearch();
        startAutoRefresh();
        initializeEventManagement();
      } catch (error) {
        console.error('Dashboard initialization error:', error);
      }
    });

    // Tab functionality
    function initializeTabs() {
      try {
        const tabs = document.querySelectorAll('.tab-item');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
          tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            
            // Remove active class from all tabs and contents
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            this.classList.add('active');
            const targetContent = document.getElementById(targetTab);
            if (targetContent) {
              targetContent.classList.add('active');
              targetContent.classList.add('animate-fade-in-up');
            }
            
            // Update campaign recipient count when switching to campaigns tab
            if (targetTab === 'campaigns') {
              updateCampaignRecipientCount();
            }
            
            // Refresh chart when switching to analytics tab
            if (targetTab === 'analytics') {
              setTimeout(() => {
                if (document.getElementById('growthChart') && subscriberDetails.length > 0) {
                  initializeGrowthChart();
                }
              }, 100);
            }

            // Load events when switching to events tab
            if (targetTab === 'events') {
              setTimeout(() => {
                loadEvents();
              }, 100);
            }
          });
        });

        // Navigation sidebar items
        const navItems = document.querySelectorAll('.nav-item[data-tab]');
        navItems.forEach(item => {
          item.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            
            // Remove active class from all nav items
            navItems.forEach(nav => nav.classList.remove('active'));
            
            // Add active class to clicked nav item
            this.classList.add('active');
            
            // Switch to corresponding tab
            const tabButton = document.querySelector(`.tab-item[data-tab="${targetTab}"]`);
            if (tabButton) {
              tabButton.click();
            }
          });
        });
      } catch (error) {
        console.error('Error initializing tabs:', error);
      }
    }

    // Load all initial data
    async function loadInitialData() {
      try {
        await Promise.all([
          loadSubscribers(),
          loadStats(),
          loadActivity(),
          checkHealth()
        ]);
      } catch (error) {
        console.error('Error loading initial data:', error);
      }
    }

    // Load subscribers from backend
    async function loadSubscribers() {
      try {
        showLoading('subscriberList');
        const response = await fetch(`${API_BASE}/subscribers`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          subscribers = data.subscribers || [];
          subscriberDetails = data.subscriber_details || [];
          currentStats = data.stats || {};
          
          renderSubscribers();
          updateStats();
          updateCampaignRecipientCount();
          
          // Initialize chart after data is loaded
          setTimeout(() => {
            if (document.getElementById('growthChart')) {
              initializeGrowthChart();
            }
          }, 100);
        } else {
          showError('subscriberList', 'Failed to load subscribers');
        }
      } catch (error) {
        console.error('Error loading subscribers:', error);
        showError('subscriberList', `Connection error: ${error.message}`);
        updateServerStatus(false);
      }
    }

    // Load statistics
    async function loadStats() {
      try {
        const response = await fetch(`${API_BASE}/stats`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          currentStats = data.stats;
          updateStats();
          document.getElementById('brevoSyncStatus').textContent = data.brevo_sync_status || '‚ùå';
        }
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Load activity log
    async function loadActivity() {
      try {
        const response = await fetch(`${API_BASE}/activity`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          activityLog = data.activity || [];
          renderActivityLog();
        }
      } catch (error) {
        console.error('Error loading activity:', error);
        showError('activityLog', 'Failed to load activity');
      }
    }

    // Check backend health
    async function checkHealth() {
      try {
        const response = await fetch(`${API_BASE}/health`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        updateServerStatus(true);
        const brevoStatusElement = document.getElementById('brevoApiStatus');
        if (brevoStatusElement) {
          brevoStatusElement.innerHTML = 
            data.brevo_status === 'connected' ? 'üü¢ Connected' : `üî¥ ${data.brevo_status}`;
          
          // Show more detailed Brevo status if available
          if (data.brevo_email) {
            brevoStatusElement.title = `Connected as: ${data.brevo_email}`;
          }
        }
      } catch (error) {
        console.error('Health check failed:', error);
        updateServerStatus(false);
        const brevoStatusElement = document.getElementById('brevoApiStatus');
        if (brevoStatusElement) {
          brevoStatusElement.innerHTML = 'üî¥ Offline';
        }
      }
    }

    // Update server status display
    function updateServerStatus(isOnline) {
      const serverStatusElement = document.getElementById('serverStatus');
      if (serverStatusElement) {
        serverStatusElement.innerHTML = isOnline ? 'üü¢ Online' : 'üî¥ Offline';
      }
    }

    // Initialize growth chart
    function initializeGrowthChart() {
      try {
        // Destroy existing chart if it exists
        if (growthChart) {
          growthChart.destroy();
        }
        
        const ctx = document.getElementById('growthChart');
        if (!ctx) {
          console.error('Growth chart canvas not found');
          return;
        }
        
        const chartContext = ctx.getContext('2d');
        
        // Generate sample data for the last 30 days
        const last30Days = [];
        const subscriberCounts = [];
        const today = new Date();
        
        for (let i = 29; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          last30Days.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
          
          // Calculate cumulative subscriber count for this date
          const dateStr = date.toISOString().split('T')[0];
          const subscribersUpToDate = subscriberDetails.filter(sub => {
            const subDate = new Date(sub.date_added).toISOString().split('T')[0];
            return subDate <= dateStr;
          }).length;
          
          subscriberCounts.push(subscribersUpToDate);
        }
        
        // Create new chart and store reference
        growthChart = new Chart(chartContext, {
          type: 'line',
          data: {
            labels: last30Days,
            datasets: [{
              label: 'Total Subscribers',
              data: subscriberCounts,
              borderColor: '#FFD700',
              backgroundColor: 'rgba(255, 215, 0, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointBackgroundColor: '#FFD700',
              pointBorderColor: '#1a1a1a',
              pointBorderWidth: 2,
              pointRadius: 5,
              pointHoverRadius: 7
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#FFD700',
                  font: {
                    weight: 'bold'
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: '#444'
                },
                ticks: {
                  color: '#cccccc'
                }
              },
              x: {
                grid: {
                  color: '#444'
                },
                ticks: {
                  color: '#cccccc',
                  maxRotation: 45
                }
              }
            },
            elements: {
              point: {
                hoverBackgroundColor: '#FFD700'
              }
            }
          }
        });
      } catch (error) {
        console.error('Error initializing growth chart:', error);
      }
    }

    // Render subscribers in the list
    function renderSubscribers(subscribersToRender = subscribers) {
      try {
        const subscriberList = document.getElementById('subscriberList');
        if (!subscriberList) {
          console.error('Subscriber list element not found');
          return;
        }
        
        if (subscribersToRender.length === 0) {
          subscriberList.innerHTML = `
            <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
              üì≠ No subscribers found
            </div>
          `;
          return;
        }

        subscriberList.innerHTML = subscribersToRender.map(email => {
          const details = subscriberDetails.find(d => d.email === email);
          const dateAdded = details ? new Date(details.date_added).toLocaleDateString() : 'Unknown';
          const source = details ? details.source : 'unknown';
          
          return `
            <div class="subscriber-item">
              <div class="subscriber-info">
                <div class="subscriber-email">${email}</div>
                <div class="subscriber-meta">Added: ${dateAdded} ‚Ä¢ Source: ${source}</div>
              </div>
              <button class="btn btn-danger btn-sm" onclick="removeSubscriber('${email}')">
                üóëÔ∏è Remove
              </button>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error rendering subscribers:', error);
      }
    }

    // Add new subscriber
    async function addSubscriber() {
      try {
        const emailInput = document.getElementById('newSubscriberEmail');
        if (!emailInput) {
          console.error('Email input not found');
          return;
        }
        
        const email = emailInput.value.trim();

        if (!email) {
          alert('Please enter an email address');
          return;
        }

        if (!isValidEmail(email)) {
          alert('Please enter a valid email address');
          return;
        }

        const response = await fetch(`${API_BASE}/subscribe`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, source: 'manual' })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success) {
          emailInput.value = '';
          await loadSubscribers();
          await loadActivity();
          showSuccess('Subscriber added successfully!');
        } else {
          alert(data.error || 'Failed to add subscriber');
        }
      } catch (error) {
        console.error('Error adding subscriber:', error);
        alert('Network error. Please try again.');
      }
    }

    // Remove subscriber
    async function removeSubscriber(email) {
      try {
        if (!confirm(`Remove ${email} from subscribers?`)) return;

        const response = await fetch(`${API_BASE}/unsubscribe`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success) {
          await loadSubscribers();
          await loadActivity();
          showSuccess('Subscriber removed successfully!');
        } else {
          alert(data.error || 'Failed to remove subscriber');
        }
      } catch (error) {
        console.error('Error removing subscriber:', error);
        alert('Network error. Please try again.');
      }
    }

    // Bulk import subscribers
    async function bulkImport() {
      try {
        const textarea = document.getElementById('bulkEmails');
        if (!textarea) {
          console.error('Bulk emails textarea not found');
          return;
        }
        
        const emailText = textarea.value.trim();
        
        if (!emailText) {
          alert('Please enter some email addresses');
          return;
        }
        
        const emails = emailText.split('\n')
          .map(email => email.trim())
          .filter(email => email && isValidEmail(email));
        
        if (emails.length === 0) {
          alert('No valid email addresses found');
          return;
        }
        
        if (!confirm(`Import ${emails.length} email addresses?`)) return;
        
        const response = await fetch(`${API_BASE}/bulk-import`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ emails, source: 'import' })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success) {
          textarea.value = '';
          await loadSubscribers();
          await loadActivity();
          
          let message = `Successfully imported ${data.added} subscribers.`;
          if (data.errors && data.errors.length > 0) {
            message += `\n\n${data.errors.length} errors occurred:\n${data.errors.slice(0, 5).join('\n')}`;
            if (data.errors.length > 5) {
              message += `\n... and ${data.errors.length - 5} more errors.`;
            }
          }
          alert(message);
        } else {
          alert(data.error || 'Failed to import subscribers');
        }
      } catch (error) {
        console.error('Error importing subscribers:', error);
        alert('Network error. Please try again.');
      }
    }

    // Manual Brevo sync
    async function manualBrevoSync() {
      try {
        if (!confirm('Manually sync all subscribers to Brevo?')) return;
        
        const button = event.target;
        if (button) {
          button.disabled = true;
          button.innerHTML = 'üîÑ Syncing...';
        }
        
        const response = await fetch(`${API_BASE}/sync-brevo`, {
          method: 'POST'
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success) {
          await loadActivity();
          let message = `Sync completed: ${data.synced} successful`;
          if (data.errors > 0) {
            message += `, ${data.errors} errors`;
          }
          alert(message);
        } else {
          alert(data.error || 'Sync failed');
        }
      } catch (error) {
        console.error('Error syncing with Brevo:', error);
        alert('Network error. Please try again.');
      } finally {
        const button = event.target;
        if (button) {
          button.disabled = false;
          button.innerHTML = 'üîÑ Manual Brevo Sync';
        }
      }
    }

    // Send campaign
    async function sendCampaign() {
      try {
        const subject = document.getElementById('campaignSubject')?.value?.trim() || '';
        const body = document.getElementById('campaignBody')?.value?.trim() || '';
        const fromName = document.getElementById('fromName')?.value?.trim() || '';
        
        if (!subject || !body) {
          alert('Please fill in both subject and email content');
          return;
        }
        
        if (subscribers.length === 0) {
          alert('No subscribers to send campaign to');
          return;
        }
        
        if (!confirm(`Send campaign to ${subscribers.length} subscribers?`)) return;
        
        const button = event.target;
        if (button) {
          button.disabled = true;
          button.innerHTML = 'üìß Sending...';
        }
        
        const response = await fetch(`${API_BASE}/send-campaign`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            subject,
            body,
            fromName: fromName || 'SideQuest Mail',
            recipients: subscribers
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success) {
          await loadActivity();
          alert(`Campaign sent successfully to ${data.sent} subscribers!`);
          // Clear form
          const subjectEl = document.getElementById('campaignSubject');
          const bodyEl = document.getElementById('campaignBody');
          if (subjectEl) subjectEl.value = '';
          if (bodyEl) bodyEl.value = '';
        } else {
          alert(data.error || 'Failed to send campaign');
        }
      } catch (error) {
        console.error('Error sending campaign:', error);
        alert('Network error. Please try again.');
      } finally {
        const button = event.target;
        if (button) {
          button.disabled = false;
          button.innerHTML = 'üìß Send Campaign';
        }
      }
    }

    // Refresh subscribers
    async function refreshSubscribers() {
      try {
        await loadInitialData();
        
        // Refresh chart if on analytics tab
        const analyticsTab = document.querySelector('.tab-item[data-tab="analytics"]');
        if (analyticsTab && analyticsTab.classList.contains('active')) {
          setTimeout(() => {
            if (document.getElementById('growthChart') && subscriberDetails.length > 0) {
              initializeGrowthChart();
            }
          }, 200);
        }
        
        showSuccess('Data refreshed!');
      } catch (error) {
        console.error('Error refreshing data:', error);
      }
    }

    // Update dashboard stats
    function updateStats() {
      try {
        const elements = {
          totalSubscribers: document.getElementById('totalSubscribers'),
          todaySignups: document.getElementById('todaySignups'),
          thisWeekSignups: document.getElementById('thisWeekSignups'),
          webSignups: document.getElementById('webSignups'),
          manualSignups: document.getElementById('manualSignups'),
          importSignups: document.getElementById('importSignups')
        };

        if (elements.totalSubscribers) elements.totalSubscribers.textContent = currentStats.total || 0;
        if (elements.todaySignups) elements.todaySignups.textContent = currentStats.today || 0;
        if (elements.thisWeekSignups) elements.thisWeekSignups.textContent = currentStats.week || 0;
        
        // Update source breakdown
        const sources = currentStats.sources || {};
        if (elements.webSignups) elements.webSignups.textContent = sources.web || 0;
        if (elements.manualSignups) elements.manualSignups.textContent = sources.manual || 0;
        if (elements.importSignups) elements.importSignups.textContent = sources.import || 0;
      } catch (error) {
        console.error('Error updating stats:', error);
      }
    }

    // Update campaign recipient count
    function updateCampaignRecipientCount() {
      try {
        const element = document.getElementById('campaignRecipientCount');
        if (element) {
          element.textContent = subscribers.length;
        }
      } catch (error) {
        console.error('Error updating campaign recipient count:', error);
      }
    }

    // Search functionality
    function setupSearch() {
      try {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredSubscribers = subscribers.filter(email => 
              email.toLowerCase().includes(searchTerm)
            );
            renderSubscribers(filteredSubscribers);
          });
        }

        // Handle Enter key in email input
        const emailInput = document.getElementById('newSubscriberEmail');
        if (emailInput) {
          emailInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              addSubscriber();
            }
          });
        }
      } catch (error) {
        console.error('Error setting up search:', error);
      }
    }

    // Export CSV
    function exportCSV() {
      try {
        if (subscribers.length === 0) {
          alert('No subscribers to export');
          return;
        }

        const csvContent = 'Email,Date Added,Source\n' + 
          subscriberDetails.map(details => 
            `${details.email},${details.date_added},${details.source}`
          ).join('\n');
          
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `sidequest_subscribers_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showSuccess(`Exported ${subscribers.length} subscribers to CSV`);
      } catch (error) {
        console.error('Error exporting CSV:', error);
        alert('Error exporting CSV. Please try again.');
      }
    }

    // Generate QR Code (placeholder - would need QR library)
    function generateQR() {
      try {
        const urlInput = document.getElementById('qrUrl');
        if (!urlInput) return;
        
        const url = urlInput.value;
        if (!url) {
          alert('Please enter a URL');
          return;
        }

        const qrDisplay = document.getElementById('qrDisplay');
        if (qrDisplay) {
          qrDisplay.style.display = 'block';
          qrDisplay.innerHTML = `
            <div style="width: 200px; height: 200px; background: var(--bg-secondary); border: 2px dashed var(--primary); display: flex; align-items: center; justify-content: center; margin: 0 auto; border-radius: var(--radius-xl); color: var(--primary); text-align: center;">
              üì± QR Code<br>
              <small style="font-size: 0.75rem; margin-top: 0.5rem;">Would generate for:<br>${url}</small>
            </div>
            <p style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted); text-align: center;">
              QR code library integration needed
            </p>
          `;
        }
      } catch (error) {
        console.error('Error generating QR code:', error);
      }
    }

    // Data management
    function backupData() {
      try {
        const backup = {
          subscribers: subscriberDetails,
          timestamp: new Date().toISOString(),
          count: subscribers.length,
          stats: currentStats
        };
        
        const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `sidequest_backup_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showSuccess('Data backup created');
      } catch (error) {
        console.error('Error backing up data:', error);
        alert('Error creating backup. Please try again.');
      }
    }

    async function clearAllData() {
      try {
        if (!confirm('‚ö†Ô∏è This will delete ALL subscribers permanently. Are you sure?')) return;
        
        const confirmation = prompt('Type "DELETE" to confirm this action:');
        if (confirmation !== 'DELETE') return;
        
        const response = await fetch(`${API_BASE}/clear-data`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ confirmation: 'DELETE' })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success) {
          await loadInitialData();
          alert(data.message);
        } else {
          alert(data.error || 'Failed to clear data');
        }
      } catch (error) {
        console.error('Error clearing data:', error);
        alert('Network error. Please try again.');
      }
    }

    // Render activity log
    function renderActivityLog() {
      try {
        const activityLogElement = document.getElementById('activityLog');
        if (!activityLogElement) return;
        
        if (activityLog.length === 0) {
          activityLogElement.innerHTML = '<p class="text-muted text-center">No recent activity</p>';
          return;
        }

        const recentActivities = activityLog.slice(0, 10);
        activityLogElement.innerHTML = recentActivities.map(activity => {
          const time = new Date(activity.timestamp).toLocaleTimeString();
          const iconClass = activity.type === 'success' ? 'success' : 
                           activity.type === 'danger' ? 'danger' : 'info';
          const icon = activity.type === 'success' ? '‚úÖ' : 
                      activity.type === 'danger' ? '‚ùå' : '‚ÑπÔ∏è';
          
          return `
            <div class="activity-item">
              <div class="activity-icon ${iconClass}">${icon}</div>
              <div class="activity-content">
                <div class="activity-text">${activity.message}</div>
                <div class="activity-time">${time}</div>
              </div>
            </div>
          `;
        }).join('');

        // Update last activity in system status
        if (recentActivities.length > 0) {
          const lastTime = new Date(recentActivities[0].timestamp).toLocaleTimeString();
          const lastActivityElement = document.getElementById('lastActivity');
          if (lastActivityElement) {
            lastActivityElement.textContent = lastTime;
          }
        }
      } catch (error) {
        console.error('Error rendering activity log:', error);
      }
    }

    // Auto refresh functionality
    function startAutoRefresh() {
      try {
        // Refresh data every 30 seconds
        setInterval(async () => {
          try {
            await loadStats();
            await loadActivity();
          } catch (error) {
            console.error('Auto refresh error:', error);
          }
        }, 30000);
      } catch (error) {
        console.error('Error starting auto refresh:', error);
      }
    }

    // Event Management Functions
    function initializeEventManagement() {
      // Setup event navigation
      document.querySelectorAll('.event-nav-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const view = this.dataset.view;
          switchEventView(view);
        });
      });

      // Setup create event form
      const createEventForm = document.getElementById('createEventForm');
      if (createEventForm) {
        createEventForm.addEventListener('submit', handleCreateEvent);
      }

      // Set default datetime to tomorrow at 7pm
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(19, 0, 0, 0);
      const dateInput = document.getElementById('eventDateTime');
      if (dateInput) {
        dateInput.value = tomorrow.toISOString().slice(0, 16);
      }
    }

    function switchEventView(view) {
      // Update navigation buttons
      document.querySelectorAll('.event-nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`.event-nav-btn[data-view="${view}"]`).classList.add('active');

      // Update views
      document.querySelectorAll('.event-view').forEach(v => {
        v.classList.remove('active');
      });
      document.getElementById(`event-${view}-view`).classList.add('active');

      // Reset edit state when switching views
      if (view === 'create') {
        currentEditingEventId = null;
        resetCreateFormUI();
        resetEventForm();
      } else {
        currentEditingEventId = null;
        resetCreateFormUI();
      }

      // Load appropriate data
      switch(view) {
        case 'list':
          loadEvents();
          break;
        case 'calendar':
          loadCalendarView();
          break;
        case 'stats':
          loadEventStats();
          break;
      }
    }

    // Load events list
    async function loadEvents() {
      const listContainer = document.getElementById('eventsList');
      
      try {
        const typeFilter = document.getElementById('eventTypeFilter')?.value || 'all';

        // Show spinner while loading
        listContainer.innerHTML = `
          <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
            <div class="spinner"></div>
            <p style="margin-top: 1rem;">Loading events...</p>
          </div>
        `;

        // Fetch events
        const response = await fetch(`${API_BASE}/api/events?type=${typeFilter}&upcoming=true`);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const data = await response.json();

        if (data.success) {
          currentEvents = data.events;
          renderEventsList(data.events);
        } else {
          console.error('API returned error:', data.error);
          listContainer.innerHTML = `<p class="text-danger">Failed to load events: ${data.error || 'Unknown error'}</p>`;
        }

      } catch (error) {
        console.error('Error loading events:', error);
        listContainer.innerHTML = `<p class="text-danger">Failed to load events: ${error.message}</p>`;
      }
    }

    // Render events list
    function renderEventsList(events) {
      const container = document.getElementById('eventsList');
      
      if (!events || events.length === 0) {
        container.innerHTML = '<p class="text-muted text-center">No upcoming events</p>';
        return;
      }

      container.innerHTML = events.map(event => {
        const eventDate = new Date(event.date_time);
        const capacityPercent = event.capacity > 0 ? (event.registration_count / event.capacity * 100) : 0;
        const spotsText = event.capacity > 0 ? `${event.spots_available} spots left` : 'Unlimited spots';
        
        return `
          <div class="event-card ${event.event_type}" onclick="showEventDetails(${event.id})">
            <div class="event-header">
              <div>
                <div class="event-title">${event.title}</div>
                ${event.game_title ? `<div class="event-game">${event.game_title}</div>` : ''}
              </div>
              <span class="event-badge badge-${event.event_type}">${event.event_type.replace('_', ' ')}</span>
            </div>
            
            <div class="event-details">
              <div class="event-detail">
                <span class="event-detail-icon">üìÖ</span>
                <span>${eventDate.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' })}</span>
              </div>
              <div class="event-detail">
                <span class="event-detail-icon">üïê</span>
                <span>${eventDate.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}</span>
              </div>
              <div class="event-detail">
                <span class="event-detail-icon">üë•</span>
                <span>${event.registration_count} registered</span>
              </div>
              ${event.entry_fee > 0 ? `
                <div class="event-detail">
                  <span class="event-detail-icon">üí∞</span>
                  <span>¬£${event.entry_fee}</span>
                </div>
              ` : ''}
            </div>
            
            ${event.capacity > 0 ? `
              <div class="capacity-bar">
                <div class="capacity-fill" style="width: ${capacityPercent}%"></div>
                <span class="capacity-text">${spotsText}</span>
              </div>
            ` : ''}
            
            <div class="event-actions">
              <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); quickRegister(${event.id})">
                ‚ûï Register
              </button>
              <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); editEvent(${event.id})">
                ‚úèÔ∏è Edit
              </button>
              <button class="btn btn-success btn-sm" onclick="event.stopPropagation(); viewAttendees(${event.id})">
                üë• Attendees
              </button>
              <button class="btn btn-warning btn-sm" onclick="event.stopPropagation(); showMarketing(${event.id})">
                üìä Marketing
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Initialize FullCalendar
    function initFullCalendar() {
      const calendarEl = document.getElementById('fullCalendar');
      
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,listWeek'
        },
        height: 'auto',
        events: loadCalendarEvents,
        
        // Event styling based on type
        eventDidMount: function(info) {
          const eventType = info.event.extendedProps.event_type || 'default';
          info.el.classList.add(eventType);
        },
        
        dateClick: function(info) {
          // Pre-fill the date in create form
          const selectedDate = info.dateStr + 'T18:00';
          
          // Switch to events tab first
          document.querySelector('.nav-item[data-tab="events"]').click();
          
          // Small delay to ensure tab loads, then switch to create view and set date
          setTimeout(() => {
            switchEventView('create');
            setTimeout(() => {
              const dateInput = document.getElementById('eventDateTime');
              if (dateInput) {
                dateInput.value = selectedDate;
              }
            }, 100);
          }, 100);
        },
        
        // Click event to view details
        eventClick: function(info) {
          showEventDetails(info.event.id);
        },
        
        dayMaxEvents: 3,
        moreLinkClick: 'popover'
      });
      
      calendar.render();
    }

    // Load events from backend for calendar
    async function loadCalendarEvents(fetchInfo, successCallback, failureCallback) {
      try {
        const start = fetchInfo.start.toISOString().split('T')[0];
        const end = fetchInfo.end.toISOString().split('T')[0];
        
        const response = await fetch(`${API_BASE}/api/events/calendar?start=${start}&end=${end}`);
        const data = await response.json();
        
        if (data.success) {
          const events = data.events.map(event => ({
            id: event.id,
            title: event.title,
            start: event.start || event.date_time,
            end: event.end || event.end_time,
            backgroundColor: getEventColor(event.event_type),
            borderColor: getEventColor(event.event_type),
            textColor: getTextColor(event.event_type),
            extendedProps: {
              event_type: event.event_type,
              game_title: event.game_title,
              description: event.description
            }
          }));
          
          successCallback(events);
        } else {
          failureCallback(data.error);
        }
      } catch (error) {
        console.error('Error loading calendar events:', error);
        failureCallback(error);
      }
    }

    // Get event color based on type
    function getEventColor(eventType) {
      switch(eventType) {
        case 'tournament': return '#FF6B35';
        case 'game_night': return '#4ECDC4';
        case 'special': return '#8B5CF6';
        case 'birthday': return '#FF69B4';
        default: return '#FFD700';
      }
    }

    // Get text color based on event type
    function getTextColor(eventType) {
      switch(eventType) {
        case 'tournament':
        case 'special':
        case 'birthday':
          return 'white';
        case 'game_night':
        default:
          return '#1a1a1a';
      }
    }

    // Load calendar view
    function loadCalendarView() {
      setTimeout(() => {
        if (!calendar) {
          initFullCalendar();
        } else {
          calendar.refetchEvents();
        }
      }, 100);
    }

    // Create/Update event
    async function handleCreateEvent(e) {
      e.preventDefault();
      
      if (e.target.dataset.submitting === 'true') return;
      e.target.dataset.submitting = 'true';
      
      try {
        const eventData = {
          title: document.getElementById('eventTitle').value,
          event_type: document.getElementById('eventType').value,
          game_title: document.getElementById('gameTitle').value,
          date_time: document.getElementById('eventDateTime').value,
          end_time: document.getElementById('eventEndTime').value,
          capacity: parseInt(document.getElementById('eventCapacity').value) || 0,
          entry_fee: parseFloat(document.getElementById('eventFee').value) || 0,
          status: document.getElementById('eventStatus').value,
          description: document.getElementById('eventDescription').value,
          prize_pool: document.getElementById('eventPrizes').value,
          requirements: document.getElementById('eventRequirements').value
        };

        let response;
        
        if (currentEditingEventId) {
          response = await fetch(`${API_BASE}/api/events/${currentEditingEventId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(eventData)
          });
        } else {
          response = await fetch(`${API_BASE}/api/events`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(eventData)
          });
        }

        const data = await response.json();
        
        if (data.success) {
          const action = currentEditingEventId ? 'updated' : 'created';
          showSuccess(`Event ${action} successfully!`);
          
          currentEditingEventId = null;
          resetCreateFormUI();
          resetEventForm();
          switchEventView('list');
        } else {
          alert('Error: ' + (data.error || `Failed to ${currentEditingEventId ? 'update' : 'create'} event`));
        }
      } catch (error) {
        console.error(`Error ${currentEditingEventId ? 'updating' : 'creating'} event:`, error);
        alert(`Failed to ${currentEditingEventId ? 'update' : 'create'} event`);
      } finally {
        e.target.dataset.submitting = 'false';
      }
    }

    // Reset event form
    function resetEventForm() {
      document.getElementById('createEventForm').reset();
      currentEditingEventId = null;
      resetCreateFormUI();
      
      // Set default datetime to tomorrow at 7pm
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(19, 0, 0, 0);
      const dateInput = document.getElementById('eventDateTime');
      if (dateInput) {
        dateInput.value = tomorrow.toISOString().slice(0, 16);
      }
    }

    function resetCreateFormUI() {
      // Reset form title
      const formTitle = document.querySelector('#event-create-view .card-title');
      if (formTitle) {
        formTitle.innerHTML = '<span>‚ûï</span>Create New Event';
      }
      
      // Reset submit button
      const submitButton = document.querySelector('#createEventForm button[type="submit"]');
      if (submitButton) {
        submitButton.textContent = 'üéÆ Create Event';
        submitButton.classList.remove('btn-warning');
        submitButton.classList.add('btn-primary');
      }
      
      // Remove cancel button
      const cancelButton = document.getElementById('cancelEditButton');
      if (cancelButton) {
        cancelButton.remove();
      }
      
      currentEditingEventId = null;
    }

    // Quick register function (placeholder)
    async function quickRegister(eventId) {
      const email = prompt('Enter subscriber email to register:');
      if (!email) return;

      try {
        const response = await fetch(`${API_BASE}/api/events/${eventId}/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email.trim().toLowerCase() })
        });

        const data = await response.json();
        
        if (data.success) {
          showSuccess(`‚úÖ Registered ${email}`);
          loadEvents();
        } else {
          alert('‚ùå Error: ' + (data.error || 'Failed to register'));
        }
      } catch (error) {
        console.error('Error registering:', error);
        alert('‚ùå Failed to register: ' + error.message);
      }
    }

    // Edit event function (placeholder)
    async function editEvent(eventId) {
      alert('Edit event functionality - would load event data into form');
    }

    // View attendees function (placeholder)
    async function viewAttendees(eventId) {
      alert('View attendees functionality - would show attendee list');
    }

    // Show marketing function (placeholder)
    async function showMarketing(eventId) {
      alert('Marketing functionality - would show QR codes and links');
    }

    // Show event details function (placeholder)
    async function showEventDetails(eventId) {
      alert('Event details functionality - would show full event information');
    }

    // Load event stats function (placeholder)
    async function loadEventStats() {
      // Placeholder stats
      document.getElementById('totalEvents').textContent = '12';
      document.getElementById('upcomingEvents').textContent = '5';
      document.getElementById('totalEventRegistrations').textContent = '48';
      document.getElementById('avgCapacityFilled').textContent = '75';

      const popularList = document.getElementById('popularEventsList');
      popularList.innerHTML = `
        <div style="display: flex; justify-content: space-between; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-lg); margin-bottom: 0.75rem;">
          <div>
            <span style="color: var(--primary); font-weight: 700;">#1</span>
            <span style="margin-left: 0.75rem; color: var(--text-primary);">Valorant Tournament</span>
          </div>
          <div>
            <span class="event-badge badge-tournament" style="margin-right: 0.75rem;">Tournament</span>
            <span style="color: var(--primary); font-weight: 600;">15 registrations</span>
          </div>
        </div>
      `;
    }

    // Close event modal
    function closeEventModal() {
      document.getElementById('eventModal').style.display = 'none';
    }

    // Refresh calendar
    function refreshCalendar() {
      if (calendar) {
        calendar.refetchEvents();
        showSuccess('Calendar refreshed!');
      }
    }

    // Utility functions
    function isValidEmail(email) {
      const pattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      return pattern.test(email);
    }

    function showLoading(elementId) {
      try {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = `
            <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
              <div class="spinner"></div>
              <p style="margin-top: 1rem;">Loading...</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error showing loading:', error);
      }
    }

    function showError(elementId, message) {
      try {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = `
            <div style="text-align: center; padding: 3rem; color: var(--danger);">
              ‚ùå ${message}
            </div>
          `;
        }
      } catch (error) {
        console.error('Error showing error:', error);
      }
    }

    function showSuccess(message) {
      try {
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 2rem;
          right: 2rem;
          background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
          color: var(--bg-primary);
          padding: 1.25rem 2rem;
          border-radius: var(--radius-xl);
          box-shadow: var(--shadow-lg);
          z-index: 1000;
          animation: slideIn 0.3s ease;
          font-weight: 600;
          border: 1px solid var(--primary);
          max-width: 400px;
        `;
        notification.textContent = `‚úÖ ${message}`;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        }, 3000);
      } catch (error) {
        console.error('Error showing success notification:', error);
      }
    }
  </script>
</body>
</html>
